<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AnimeCloud – Přihlášení / Registrace</title>
  <link rel="stylesheet" href="main.css" />
  <style>
    /* Fallback pro případ, že main.css není k dispozici */
    :root { --bg:#0e0e12; --card:#181820; --line:#2a2a36; --ac:#7c5cff; --txt:#fff; --muted:#a7a9c9; }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--txt);margin:0}
    /* topbar */
    .topbar{position:sticky;top:0;z-index:10;background:#111117;border-bottom:1px solid var(--line)}
    .topbar .inner{max-width:1080px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:10px 16px}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:#eaeaff}
    .brand svg{width:28px;height:28px}
    nav a{color:#cfd2ff;text-decoration:none;margin-left:16px}
    nav a:hover{color:#fff}
    .wrap{min-height:calc(100vh - 60px);display:flex;align-items:center;justify-content:center;padding:24px}
    .panel{width:100%;max-width:480px;background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.25);padding:28px}
    h1{margin:0 0 18px;text-align:center;font-size:24px}
    .tabs{display:flex;gap:6px;justify-content:center;margin-bottom:18px}
    .tabs button{flex:1;max-width:200px;background:#242437;border:1px solid #33344a;color:#cfd2ff;padding:10px 14px;border-radius:10px;cursor:pointer}
    .tabs button.active{background:var(--ac);color:#fff;border-color:var(--ac)}
    form{display:none;text-align:center}
    form.active{display:block}
    label{display:block;margin:8px 0 6px;font-weight:600;opacity:.9;text-align:center}
    input{
      width:100%;max-width:360px;margin:0 auto 10px;display:block;
      background:#0f1020;border:1px solid #2e3050;color:#e9e9ff;
      padding:11px 12px;border-radius:10px;outline:none
    }
    .btn{width:100%;max-width:360px;margin:10px auto 0;display:block;
      background:var(--ac);border:0;color:#fff;padding:12px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    .muted{color:var(--muted);font-size:12px;margin-top:10px;text-align:center}
    .msg{margin:10px auto 0;max-width:360px;text-align:center;font-size:14px}
    .msg.ok{color:#8ef0a5}.msg.err{color:#ff9a9a}
  </style>
</head>
<body>
  <!-- HORNÍ MENU -->
  <header class="topbar">
    <div class="inner">
      <a class="brand" href="/index.html" aria-label="AnimeCloud domů">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 2l3.5 6.8 7.5 1.1-5.4 5.3 1.3 7.5L12 19l-6.9 3.7 1.3-7.5L1 9.9l7.5-1.1L12 2z" stroke="#7c5cff" />
        </svg>
        <strong>AnimeCloud</strong>
      </a>
      <nav>
        <a href="/index.html">Domů</a>
        <a href="/feedback.html">Info</a>
        <a href="/login.html"><strong>Přihlášení</strong></a>
      </nav>
    </div>
  </header>

  <div class="wrap">
    <div class="panel">
      <h1>AnimeCloud</h1>
      <div class="tabs">
        <button id="tabLogin" class="active" type="button">Přihlášení</button>
        <button id="tabReg" type="button">Registrace</button>
      </div>

      <!-- LOGIN -->
      <form id="loginForm" class="active" novalidate>
        <label for="loginEmail">E-mail</label>
        <input id="loginEmail" type="email" placeholder="vas@email.cz" required />
        <label for="loginPass">Heslo</label>
        <input id="loginPass" type="password" placeholder="••••••••" required />
        <button class="btn" type="submit">Přihlásit se</button>
        <div id="loginMsg" class="msg"></div>
        <p class="muted">Nemáš účet? Přepni na „Registrace“ výše.</p>
      </form>

      <!-- REGISTER -->
      <form id="registerForm" novalidate>
        <label for="regEmail">E-mail</label>
        <input id="regEmail" type="email" placeholder="vas@email.cz" required />
        <label for="regName">Jméno / přezdívka</label>
        <input id="regName" type="text" placeholder="Tvoje jméno" required />
        <label for="regPass">Heslo</label>
        <input id="regPass" type="password" placeholder="min. 8 znaků" required />
        <label for="regPass2">Potvrzení hesla</label>
        <input id="regPass2" type="password" placeholder="zadej stejné heslo" required />
        <button class="btn" type="submit">Registrovat</button>
        <div id="regMsg" class="msg"></div>
        <p class="muted">Po registraci ti přijde ověřovací e-mail.</p>
      </form>
    </div>
  </div>

  <script>
    // přepínání záložek
    const tabLogin = document.getElementById('tabLogin');
    const tabReg = document.getElementById('tabReg');
    const fLogin = document.getElementById('loginForm');
    const fReg = document.getElementById('registerForm');
    tabLogin.onclick = () => { tabLogin.classList.add('active'); tabReg.classList.remove('active'); fLogin.classList.add('active'); fReg.classList.remove('active'); };
    tabReg.onclick   = () => { tabReg.classList.add('active'); tabLogin.classList.remove('active'); fReg.classList.add('active'); fLogin.classList.remove('active'); };

    async function jsonFetch(url, data) {
      const res = await fetch(url, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(data)
      });
      let body = {};
      try { body = await res.json(); } catch(e) {}
      return { ok: res.ok, status: res.status, body };
    }

    // LOGIN
    fLogin.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPass').value;
      const m = document.getElementById('loginMsg'); m.className='msg'; m.textContent='';

      const r = await jsonFetch('/auth/login', { email, password });
      if (r.ok) {
        m.classList.add('ok'); m.textContent = 'Přihlášení úspěšné. Přesměrovávám…';
        setTimeout(() => location.href = '/account.html', 600);
      } else {
        m.classList.add('err');
        const code = r.body && r.body.error;
        m.textContent = code === 'not_verified'
          ? 'Účet ještě není ověřen. Zkontroluj e-mail.'
          : (r.body.message || 'Přihlášení selhalo: ' + (code || r.status));
      }
    });

    // REGISTRATION
    fReg.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('regEmail').value.trim();
      const name  = document.getElementById('regName').value.trim();
      const p1    = document.getElementById('regPass').value;
      const p2    = document.getElementById('regPass2').value;
      const m = document.getElementById('regMsg'); m.className='msg'; m.textContent='';

      if (p1 !== p2) { m.classList.add('err'); m.textContent='Hesla se neshodují.'; return; }

      const r = await jsonFetch('/auth/register', { email, name, password: p1, password2: p2 });
      if (r.ok) {
        m.classList.add('ok');
        m.textContent = 'Registrováno. Zkontroluj e-mail a ověř účet.';
        tabLogin.click();
      } else {
        m.classList.add('err');
        m.textContent = r.body && r.body.error ? ('Registrace selhala: ' + r.body.error) : 'Registrace selhala.';
      }
    });
  </script>
</body>
</html>

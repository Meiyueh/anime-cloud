<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <title>Profil ‚Ä¢ AnimeCloud</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles/main.css" />
  <style>
    .container{max-width:820px;margin:24px auto;padding:0 16px}
    .cover{display:flex;gap:16px;align-items:center}
    .profile-avatar{background:var(--border);width:96px;height:96px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2rem;color:var(--brand);flex-shrink:0;overflow:hidden;border:1px solid var(--border)}
    .profile-avatar img{width:100%;height:100%;object-fit:cover}
    .badges{display:flex;gap:8px;flex-wrap:wrap;margin-top:4px}
    .muted{color:var(--muted)}
    .toolbar{display:flex;gap:.6rem;justify-content:flex-end;align-items:center;flex-wrap:wrap;margin-top:.6rem}
    .btn{ padding:.48rem .8rem; border-radius:8px; width:auto !important; }
    .msg{margin-top:12px}
    .hidden{display:none !important}
  </style>
</head>
<body>
  <header class="site-header">
    <a href="/index.html" class="brand"><img src="/assets/logo.svg" alt="AnimeCloud" /></a>
    <nav class="top-nav">
      <a href="/index.html">Info</a>
      <a href="/upload.html" id="nav-upload" class="hidden">Upload</a>
      <a href="/feedback.html" id="nav-feedback" class="hidden">Feedback</a>
      <a href="/account.html" id="nav-account" class="hidden">√öƒçet</a>
      <a href="/login.html" id="nav-login">P≈ôihl√°≈°en√≠</a>
      <a href="/admin.html" id="nav-admin" class="hidden">Admin</a>
      <a href="#" id="nav-theme" title="P≈ôepnout t√©ma">üåì</a>
    </nav>
  </header>

  <main class="container">
    <div class="card">
      <div class="cover">
        <div class="profile-avatar"><img id="pfp" alt="avatar" /><span id="pfp-fb" class="hidden">üë§</span></div>
        <div>
          <h2 id="name">‚Äî</h2>
          <div class="badges">
            <span id="badge-title" class="badge hidden"></span>
            <span id="badge-vis" class="badge"></span>
          </div>
          <div class="muted">
            <span id="slug">@‚Äî</span> ‚Ä¢ <span id="joined">ƒålenem od ‚Äî</span>
          </div>
        </div>
      </div>

      <div class="toolbar">
        <button id="btnCopy" class="btn btn-outline">Zkop√≠rovat odkaz</button>
      </div>

      <p id="privNote" class="msg hidden">üîí Tento profil je soukrom√Ω. Vlastn√≠k zat√≠m nesd√≠l√≠ sv√© informace ve≈ôejnƒõ.</p>
      <p id="linkNote" class="msg hidden">üîó Tento profil je p≈ô√≠stupn√Ω jen p≈ôes odkaz.</p>
      <p id="notFound" class="msg hidden">‚ùå U≈æivatel nenalezen.</p>
    </div>
  </main>

  <footer class="site-footer"><small>Ve≈ôejn√Ω profil ‚Ä¢ AnimeCloud</small></footer>

  <script src="/scripts/app.js"></script>
  <script>
    App.initNavbar();

    // --- utils ---
    const ddmmyyyy = iso=>{
      if(!iso) return '‚Äî';
      const d = new Date(iso);
      return String(d.getDate()).padStart(2,'0')+'.'+String(d.getMonth()+1).padStart(2,'0')+'.'+d.getFullYear();
    };
    const el = id=>document.getElementById(id);
    const show = (id, on=true)=>{ const x=el(id); if(!x) return; x.classList[on?'remove':'add']('hidden'); };

    // --- resolve slug z /u/<slug> ---
    const rawPath = (location.pathname || '');
    const slug = decodeURIComponent((rawPath.split('/u/')[1] || '').split(/[?#]/)[0] || '').trim();

    async function loadProfile(){
      if(!slug){ show('notFound', true); return; }
      try{
        const r = await fetch('/api/profile/'+encodeURIComponent(slug));
        const j = await r.json().catch(()=> ({}));
        if(!r.ok || !j?.ok || !j?.profile){ throw new Error('user not found'); }

        const p = j.profile;
        // Jm√©no / slug
        el('name').textContent = p.display_name || p.slug || 'U≈æivatel';
        el('slug').textContent = '@' + (p.slug || slug);

        // Avatar + fallback
        const img = el('pfp'), fb = el('pfp-fb');
        img.onload = ()=>{ show('pfp', true); show('pfp-fb', false); };
        img.onerror= ()=>{ show('pfp', false); show('pfp-fb', true); fb.textContent = (String(p.display_name||p.slug||'?')[0]||'?').toUpperCase(); };
        if(p.avatar_url){
          img.src = p.avatar_url + '?ts=' + Date.now();
          show('pfp', true);
          show('pfp-fb', false);
        }else{
          show('pfp', false);
          fb.textContent = (String(p.display_name||p.slug||'?')[0]||'?').toUpperCase();
          show('pfp-fb', true);
        }

        // ƒålenstv√≠
        el('joined').textContent = 'ƒålenem od ' + ddmmyyyy(p.joined_at);

        // Titul(y)
        const t = Array.isArray(p.titles) ? (p.titles[0]||'') : '';
        if(t){
          const b = el('badge-title');
          b.textContent = t;
          show('badge-title', true);
        }else{
          show('badge-title', false);
        }

        // Viditelnost ‚Äì badge + pozn√°mka
        const vis = (p.visibility || 'private').toLowerCase();
        const bvis = el('badge-vis');
        bvis.textContent = vis === 'public' ? 'Ve≈ôejn√Ω' : (vis === 'link' ? 'Jen p≈ôes odkaz' : 'Soukrom√Ω');
        if(vis === 'private'){
          show('privNote', true);
        }else if(vis === 'link'){
          show('linkNote', true);
        }

      }catch(e){
        show('notFound', true);
      }
    }

    // kop√≠rov√°n√≠ ve≈ôejn√© URL
    el('btnCopy').addEventListener('click', async ()=>{
      const url = location.origin + '/u/' + encodeURIComponent(slug||'');
      try{ await navigator.clipboard.writeText(url); App.toast('Odkaz zkop√≠rov√°n','ok'); }
      catch{
        const tmp=document.createElement('input');
        tmp.value=url; tmp.style.position='fixed'; tmp.style.opacity=0;
        document.body.appendChild(tmp); tmp.select(); document.execCommand('copy'); tmp.remove();
        App.toast('Odkaz zkop√≠rov√°n','ok');
      }
    });

    loadProfile();
  </script>
</body>
</html>

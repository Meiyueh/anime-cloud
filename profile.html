<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <title>Profil • AnimeCloud</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles/main.css" />
  <style>
    .container{max-width:980px;margin:24px auto;padding:0 16px}
    .cover{display:flex;gap:16px;align-items:center}
    .avatar{width:96px;height:96px;border-radius:50%;object-fit:cover;border:1px solid var(--border)}
    .ava-fallback{width:96px;height:96px;border-radius:50%;display:none;align-items:center;justify-content:center;
      background:var(--border); color:var(--brand); font-weight:700; font-size:32px; border:1px solid var(--border)}
    .muted{color:var(--muted)}
    .badges{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.4rem}
    .chip{border:1px solid var(--border);border-radius:999px;padding:.15rem .55rem}
    .notice{margin-top:1rem;padding:.6rem .8rem;border:1px dashed var(--border);border-radius:10px;color:var(--muted);display:none}
  </style>
</head>
<body>
  <header class="site-header">
    <a href="/index.html" class="brand"><img src="/assets/logo.svg" alt="AnimeCloud" /></a>
    <nav class="top-nav">
      <a href="/index.html">Info</a>
      <a href="/anime.html">Anime</a>
      <a href="/account.html">Účet</a>
    </nav>
  </header>

  <main class="container">
    <div class="cover">
      <img id="ava" class="avatar" src="" alt="avatar" />
      <div id="avaFallback" class="ava-fallback">?</div>
      <div>
        <h1 id="dn" style="margin:.2rem 0">—</h1>
        <div class="muted" id="slug">@—</div>
        <div class="muted" id="joined">Členem od —</div>
        <div id="titles" class="badges"></div>
      </div>
    </div>
    <div id="privateNote" class="notice">Tento profil je aktuálně neveřejný.</div>
  </main>

  <footer class="site-footer"><small>AnimeCloud</small></footer>

  <script>
    function ddmmyyyy(iso){
      if(!iso) return '—';
      const d = new Date(iso);
      return String(d.getDate()).padStart(2,'0')+'.'
           + String(d.getMonth()+1).padStart(2,'0')+'.'
           + d.getFullYear();
    }
    const slug = decodeURIComponent(location.pathname.replace(/^.*\/u\//,'').replace(/\/.*$/,''));

    async function loadProfile(){
      try{
        const r = await fetch(`/api/profile/${encodeURIComponent(slug)}`);
        const j = await r.json();
        if(!j.ok) throw 0;
        const p = j.profile || {};

        document.getElementById('dn').textContent = p.display_name || slug;
        document.getElementById('slug').textContent = '@' + (p.slug || slug);
        document.getElementById('joined').textContent = 'Členem od ' + ddmmyyyy(p.joined_at);

        const tWrap = document.getElementById('titles');
        tWrap.innerHTML = '';
        (p.titles || []).forEach(t=>{
          const s = document.createElement('span');
          s.className='chip'; s.textContent=t; tWrap.appendChild(s);
        });

        const img = document.getElementById('ava');
        const fb  = document.getElementById('avaFallback');
        const initial = (p.display_name || p.slug || '?').trim()[0]?.toUpperCase() || '?';

        if (p.avatar_url){
          img.src = p.avatar_url + (p.avatar_url.includes('?')?'&':'?') + 'ts=' + Date.now();
          img.style.display=''; fb.style.display='none';
          img.onerror = ()=>{ img.style.display='none'; fb.textContent=initial; fb.style.display='flex'; };
        } else {
          img.style.display='none'; fb.textContent=initial; fb.style.display='flex';
        }

        if ((p.visibility||'public') !== 'public'){
          document.getElementById('privateNote').style.display='';
        }
      }catch{
        document.body.innerHTML =
          "<main class='container'><h1>Profil nenalezen</h1><p class='muted'>Zkontroluj prosím adresu.</p></main>";
      }
    }
    loadProfile();
  </script>
</body>
</html>
